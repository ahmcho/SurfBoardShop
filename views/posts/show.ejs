<% layout('layouts/post-show-layout') -%>
<h1><%= post.title %></h1>
<div>Price: <%= post.price %></div>
<div><%= post.description %></div>
<div><%= post.location %></div>
<div>
    <% post.images.forEach((image) => {%>
        <img src="<%= image.url %>" width="200px" alt="Surf board image">
    <% }); %>
</div>
<div id='map'></div>
<div>
    <a href="/posts/<%= post.id %>/edit">
        <button>Edit</button>
    </a>
</div>
<div>
    <form action="/posts/<%= post.id %>?_method=DELETE" method="POST">
        <input type="submit" value="Delete">
    </form>
</div>
<h2>Create a review</h2>
<form action="/posts/<%= post.id %>/reviews" method="POST">
    <textarea name="review[body]"  required></textarea>
    <input type="number" name="review[rating]" min="1" max="5" step="1" required>
    
    <input type="submit" value="Post a review">
</form>

<!-- Display all reviews -->
<h3>Reviews</h3>
<% console.log(post.reviews) %>
<% post.reviews.forEach(function(review) { %>
    <div>
        <h4>Author: <%= review.author.username %></h4>
        <%= review.body %><br>
        Rating: <%= review.rating %>
    </div>
    <% if(review.author.equals(currentUser._id)) { %>
        <div>
            <button class="toggle-edit-form">Edit</button>

            <form class="edit-review-form" action="/posts/<%= post.id %>/reviews/<%= review.id %>?_method=PUT" method="POST">
                <textarea name="review[body]"  required><%= review.body %></textarea>
                <input type="number" name="review[rating]" min="1" max="5" step="1" required value="<%= review.rating %>">
                
                <input type="submit" value="Update">
            </form>
            <form  action="/posts/<%= post.id %>/reviews/<%= review.id %>?_method=DELETE" method="POST">
                <input type="submit" value="Delete">
            </form>
        </div>
    <% } %>
    <hr>
<% }); %>